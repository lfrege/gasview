var qs = require('querystring');
var url = require('url');
var path = require('path'); 
var fs = require('fs');

testExistance = function(exists, fullpath, req, res) 
{
	if (exists)
	{
		var file = fs.createReadStream(fullpath);

		res.writeHead(200, {'Content-Type': 'text/html'}); 
		file.setEncoding('utf8');
 
		file.on('data', function (data) { res.write(data); });
		file.on('end', function () { res.end(); });
	}
	else
	{
		res.writeHead(404, {'Content-Type': 'text/html'});
		res.end("file: " + fullpath + " not found.");
	}
}

function staticContent(filename, req, res)
{
	var fullpath = path.normalize("static/" + path.normalize(filename));
	path.exists(fullpath, function (exists) { testExistance(exists, fullpath, req, res); } );
}


start = function(req, res)
{
	var args = url.parse(req.url, true);
	req.body = qs.parse(req.body);
	if (args.pathname == "/addfile") { staticContent("addfile.htm", req, res); }
	else
	{
	res.writeHead(200, {'Content-Type': 'text/html'});
	res.write(JSON.stringify(req.body));
	res.end(JSON.stringify(args));
	}
}

module.exports.staticContent = staticContent;
module.exports.start = start;
